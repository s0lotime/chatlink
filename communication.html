<!DOCTYPE html>
<html>
<head>
  <title>Chatlink Call</title>
</head>
<body>
  <h1>WebRTC Signaling Test</h1>
  <pre id="log"></pre>

  <script>
    const room = "testroom"; // You can make this dynamic
    const socket = new WebSocket(`wss://chatlink.space/messagerouting/call/connection?room=${room}`);
    const log = (msg) => document.getElementById('log').textContent += msg + "\n";

    let myId = null;

    socket.onopen = () => {
      log("Connected to signaling server");
    };

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === "welcome") {
        myId = msg.id;
        log(`My client ID: ${myId}`);
      } else if (msg.type === "offer" || msg.type === "answer" || msg.type === "ice") {
        log(`Received ${msg.type} from ${msg.from}`);
        // Here youâ€™d handle signaling for WebRTC
      } else if (msg.error) {
        log("Error: " + msg.error);
      }
    };

    socket.onerror = (err) => {
      log("WebSocket error: " + err);
    };

    // Simulate sending an offer to another client
    function sendTestMessage(toId) {
      socket.send(JSON.stringify({
        to: toId,
        type: "offer",
        payload: { sdp: "dummySDP" }
      }));
    }
  </script>
</body>
</html>
