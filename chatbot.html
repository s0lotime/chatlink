<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chatbot - Chatlink</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.chatlink.space/css/chat.css" />
  <link rel="apple-touch-icon" href="/favicon.ico">
  <style>
    .chat-message {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
      max-width: 70%;
      word-wrap: break-word;
    }

    .user-message {
      background-color: #d1f1f1;
      align-self: flex-end;
    }

    .bot-message {
      background-color: #f0f0f0;
      align-self: flex-start;
    }
  </style>
</head>

<body>
  <div class="chat-wrapper" role="main">
    <div class="chat-container" id="messages" role="region" aria-live="polite"></div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Ask the chatbot..." />
      <button id="sendButton">Send</button>
    </div>
  </div>

  <script src="https://cdn.chatlink.space/js/chatlink.js"></script>
  <script>
    async function sendMessageToChatbot(message) {
      const response = await fetch('https://api.chatlink.space/chatbot', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message }),
      });

      if (!response.ok) {
        console.error('Failed to get response from chatbot');
        return 'Sorry, something went wrong. Please try again.';
      }

      const data = await response.json();
      return data.reply || 'Sorry, I couldn\'t understand that. Please try again.';
    }

    function displayMessage(content, sender = 'user') {
      const messagesContainer = document.getElementById('messages');
      const msg = document.createElement('div');
      msg.className = sender === 'user' ? 'chat-message user-message' : 'chat-message bot-message';
      msg.innerHTML = content;
      messagesContainer.appendChild(msg);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function displayLoadingMessage() {
      const messagesContainer = document.getElementById('messages');
      const loadingMessage = document.createElement('div');
      loadingMessage.className = 'chat-message bot-message';
      loadingMessage.innerHTML = 'Bot is typing...';
      messagesContainer.appendChild(loadingMessage);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      return loadingMessage;
    }

    document.getElementById('sendButton').addEventListener('click', async () => {
      const messageInput = document.getElementById('messageInput');
      const userMessage = messageInput.value.trim();

      if (!userMessage) return;

      displayMessage(userMessage, 'user');
      messageInput.value = ''; // Clear the input field

      const loadingMessage = displayLoadingMessage();
      const botResponse = await sendMessageToChatbot(userMessage);
      loadingMessage.remove(); // Remove loading message
      displayMessage(botResponse, 'bot');
    });

    document.getElementById('messageInput').addEventListener('keydown', async (event) => {
      if (event.key === 'Enter') {
        event.preventDefault(); // Prevent the Enter key from adding a newline
        const messageInput = document.getElementById('messageInput');
        const userMessage = messageInput.value.trim();

        if (userMessage) {
          displayMessage(userMessage, 'user');
          messageInput.value = ''; // Clear the input field
          const loadingMessage = displayLoadingMessage();
          const botResponse = await sendMessageToChatbot(userMessage);
          loadingMessage.remove(); // Remove loading message
          displayMessage(botResponse, 'bot');
        }
      }
    });
  </script>
</body>
</html>
